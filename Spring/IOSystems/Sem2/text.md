# 0. Вступление 
Сегодня мы рассмотрим Fibre Channel(волоконный канал) — специализированный интерфейс для высокоскоростной передачи данных,  
особенно популярный в системах хранения информации.  

# 1. Слайд История и версии   
История Fibre Channel началась в 1988 году, а в 1994 году был утверждён ANSI как стандарт,  
упрощавший интерфейс HIPPI, для которого применялся массивный 50-парный кабель с громоздкими разъёмами.  
Первоначально интерфейс Fibre Channel должен был повысить дальность и упростить подключение линий передачи, а не увеличить скорость.  

 Изначально технология Fibre Channel предполагала поддержку только волоконно-оптических линий (fiber optic).  
 Однако, когда добавилась поддержка меди, было принято решение название в принципе сохранить,  
 но для отсылки на стандарт использовать британское слово Fibre. Американское Fiber сохраняется преимущественно для отсылки на оптоволокно.  
 
Потребность в Fibre Channel возникла в конце 1980-х - начале 1990-х годов из-за ограничений существовавших на тот момент технологий:  

Ограничения SCSI:  
Расстояние: Параллельный SCSI имел очень ограниченную длину кабеля (несколько метров).  
Количество устройств: Ограниченное число устройств на одной шине.  
Пропускная способность: Со временем становилась недостаточной для растущих объемов данных.  
Гибкость: Сложность подключения и масштабирования.  
Непригодность традиционных сетей (Ethernet, Token Ring):  

Эти сети не были разработаны для специфических требований хранения данных:   
они допускали потери пакетов (требовали повторной передачи на более высоком уровне), имели более высокие задержки и не гарантировали доставку.  

Цели создания Fibre Channel:  
Высокая скорость: Превзойти существовавшие интерфейсы.  
Большие расстояния: Поддержка соединений на километры.  
Большое количество устройств: Возможность подключения тысяч устройств.  
Надежность: Гарантированная доставка данных без потерь (lossless).  
Гибкость: Поддержка различных топологий (точка-точка, коммутируемая фабрика, арбитражная петля).  

Версии Fibre Channel обычно именуются по их номинальной пропускной способности. Важно отметить,  
что указанные скорости являются скоростями передачи данных в одну сторону (simplex).  
Поскольку FC является полнодуплексным, общая пропускная способность удваивается.  

# 2.Слайд Скорость передачи данных  
Скорости и версии представлены на слайде. Поскольку FC является полнодуплексным, общая пропускная способность удваивается.  

# 3.Слайд Уровни сетевой модели, которые реализованы в интерфейсе (физический, канальный и др.) 

FC-0 — Физический уровень интерфейсов и носителей. Описывает физическую среду: кабели, коннекторы, HBA, трансиверы, электрические и оптические параметры.  

FC-1 — уровень передачи и кодирования. Здесь описывается как данные будут кодироваться перед передачей и декодироваться после.  
На этом уровне определяются три основные функции:  
Кодирование / декодирование  
Ordered sets(служебные данные - разделители фреймов, сигналы готовности, и т.д)  
Инициализация соединения (link initialization с обменом подтверждениями)  

FC-2 —  Канальный протокол. уровень кадрирования и сигналов. Определяет структуру и организацию передаваемой информации, а также контроль и управление её передачей.  
Функции, осуществляемые на этом уровне:  
Кадрирование (определение структуры кадра / фрейма).  
Управление последовательностями (Sequence management)  
Управление обменом (Exchange management)  
Управление потоком (Flow control)  

FC-3 — уровень базовых служб. Уровень заложен для новых функций, которые могут быть внедерены в Fibre Channel в будущем.   
На этом уровне обеспечивается шифрование и сжатие данных перед отправкой,  
а также такие вещи как расщепление потока данных (striping) по нескольким путям.  

FC-4 — уровень отображения протоколов. Описывает протоколы, которые могут использовать FC в качестве транспорта и,  
 собственно, порядок использования (маппинг этих протоколов на нижние уровни FC0-3). Применительно к SAN это могут быть:  
Fibre Channel Protocol for SCSI-3 (SCSI-FCP) — проброс SCSI  
Fibre Channel Link Encapsulation (FC-LE) — проброс TCP/IP  



# 4.Слайд Среда передачи данных (оптика, медный провод, воздух и т.п) 
  
Максимальная длина соединений зависит от кабеля: оптика даёт преимущество до 10 км, а медь ограничена несколькими десятками метров(30) и редко используется,  
так что я не включал ее в таблицу  

# Слайд Возможные топологии соединения устройств 

## Топологии FC определяют взаимное подключение устройств, а именно передатчиков (трансмиттеров) и приёмников (ресиверов) устройств.
 Существует три типа топологии FC:  
Точка-точка (point-to-point)  
Устройства соединены напрямую — трансмиттер одного устройства соединён с ресивером второго, и наоборот.  
Все отправленные одним устройством кадры предназначены для второго устройства.  

## Управляемая петля (arbitrated loop)
Устройства объединены в петлю — трансмиттер каждого устройства соединён с ресивером следующего.  
 Перед тем, как петля сможет служить для передачи данных, устройства договариваются об адресах.  
 Для передачи данных по петле устройство должно завладеть «эстафетой» (token).  
 
## Коммутируемая связная архитектура
Основана на применении коммутаторов. Позволяет подключать большее количество устройств, чем в управляемой петле,
при этом добавление новых устройств не влияет на передачу данных между уже подключёнными устройствами

# Слайд Механизмы обеспечения надежной передачи данных (использование контрольных сумм, пакетов подтверждения и др.)
8b/10b (для скоростей до 8GFC и 10GFC): Каждый 8-битный байт данных преобразуется в 10-битный символ для передачи. Эти дополнительные 2 бита используются для:

DC-балансировка: Гарантирует, что в потоке битов будет примерно одинаковое количество нулей и единиц, что важно для работы оптических и электрических приемопередатчиков.

Обнаружение ошибок: Не все 10-битные комбинации являются допустимыми символами. Если принимается недопустимый символ, это указывает на ошибку передачи.

Разграничение кадров и специальных символов: Позволяет легко идентифицировать начало и конец кадра, а также служебные символы.

64b/66b (для 16GFC и выше): 
Каждые 64 бита данных предваряются 2-битным заголовком синхронизации.
 Это снижает избыточность по сравнению с 8b/10b, но также обеспечивает механизмы для синхронизации и обнаружения ошибок.
 Ошибки в заголовке или данных могут быть обнаружены.

## Контрольная сумма кадра (CRC - Cyclic Redundancy Check):

Каждый кадр Fibre Channel (FC Frame) содержит 32-битную контрольную сумму (CRC), рассчитанную по содержимому кадра (исключая некоторые поля заголовка, которые могут меняться при прохождении через коммутаторы, например, SOF/EOF).

Отправитель вычисляет CRC и добавляет его в кадр.

Получатель (каждый коммутатор на пути и конечный порт) пересчитывает CRC на основе полученных данных. Если вычисленная CRC не совпадает с полученной, кадр считается поврежденным и отбрасывается.

## Механизм кредитов Buffer-to-Buffer (BB_Credit):

Это основной механизм предотвращения потерь кадров из-за переполнения буферов в коммутаторах или на конечных устройствах. Он обеспечивает управление потоком на каждом отдельном линке (между двумя непосредственно соединенными портами, например, HBA и коммутатор, или два коммутатора).

Как работает:

При установлении соединения (логине) два порта обмениваются информацией о количестве буферов, доступных для приема кадров (их BB_Credit).

Отправляющий порт имеет счетчик BB_Credit. Перед отправкой кадра он уменьшает этот счетчик. Если счетчик равен нулю, порт не может отправлять кадры, пока не получит подтверждение о высвобождении буфера на принимающей стороне.

Принимающий порт, после успешного приема и обработки кадра (и освобождения буфера), отправляет обратно специальный примитивный сигнал (Primitive Signal) – R_RDY (Receiver Ready).

Получив R_RDY, отправляющий порт увеличивает свой счетчик BB_Credit, что позволяет ему отправить следующий кадр.

## Кредиты End-to-End (EE_Credit):

Похожий на BB_Credit механизм, но работает между конечными точками (N_Ports – например, HBA сервера и порт дискового массива), а не на каждом отдельном участке.

Он гарантирует, что у конечного получателя есть ресурсы для обработки последовательности (Sequence) кадров.

EE_Credit управляется на уровне Exchange (обмен, состоящий из одной или нескольких последовательностей).

## Таймауты (E_D_TOV - Error Detect Timeout Value):

Существуют таймауты, которые позволяют обнаруживать "зависшие" операции или потерянные ответы. 
Если ожидаемый кадр (например, ответ на команду или следующий кадр в последовательности) не приходит в течение определенного времени,
может быть инициирована процедура восстановления или ошибки.

## Сообщения об ошибках (Link Error Status Block - LESB):

Коммутаторы и конечные устройства могут собирать статистику об ошибках на линках (например, ошибки CRC, потеря синхронизации, недопустимые символы)
 и сообщать о них для диагностики.

# Слайд Описание сигнального интерфейса с указанием минимального количества линий необходимых для передачи данных (не считая питания и земли) 


# Слайд Синхронный или асинхронный интерфейс 


# Слайд дуплексный


# Слайд Роли устройств (ведущий, ведомый и др.) 


# Слайд Особенности


# Слайд Изображения и краткое описание разъемов для стандартных и специальных условий эксплуатации 


# Слайд Сферы использования 




